<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper  namespace = "com.cqjtu.bysj.mapper.AdminUserMapper">


    <select id="getPasswordByJobNo" resultType="string" parameterType="string">
        select password from admin_user
        <where>
            <if test="jobNo != null and jobNo !=''" >
                and  job_no = #{jobNo}
            </if>
        </where>
    </select>
    <select id="getRoleListByJobNo" resultType="com.cqjtu.bysj.entity.Role" parameterType="string">
        select
        r.id roleId,
        r.role_name roleName
        from sys_user_roles s
        left join sys_role r

        on s.roles_id = r.id
        <where>
            <if test="jobNo != null and jobNo !=''" >
                and  job_no = #{jobNo}
            </if>
        </where>
    </select>
    <select id="findUserByJobNo" resultType="com.cqjtu.bysj.entity.AdminUser" parameterType="string">
        select
        id userId,
        username,
        job_no jobNo,
        password,
        email,
        phone,
        sex,
        birthday
        from admin_user
        <where>
            <if test="jobNo != null and jobNo !=''" >
                and  job_no = #{jobNo}
            </if>
        </where>
    </select>


    <update id="updatePwdByJobNo" parameterType="map">
        update admin_user
        set password = #{newPassword}
        where job_no = #{jobNo}
    </update>

    <insert id="batchImport" parameterType="java.util.List">
        insert into admin_user(id,username, job_no, password)
        values

        <foreach collection="list" item="item" index="index" separator="," >
            (null,
            #{item.username},
            #{item.jobNo},
            #{item.password}
            )
        </foreach>

    </insert>
    <insert id="batchImportUserRole" parameterType="java.util.List">
        insert into sys_user_roles(id,job_no, roles_id)
        values

        <foreach collection="list" item="item" index="index" separator="," >
            (null,
            #{item.jobNo},
            #{item.roleId}
            )
        </foreach>

    </insert>





</mapper>
